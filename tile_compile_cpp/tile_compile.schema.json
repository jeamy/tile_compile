{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "tile_compile v3 config",
  "type": "object",
  "properties": {
    "pipeline": {
      "type": "object",
      "properties": {
        "mode": { "type": "string", "enum": ["production", "test"] },
        "abort_on_fail": { "type": "boolean" }
      }
    },
    "data": {
      "type": "object",
      "properties": {
        "image_width": { "type": "integer", "minimum": 1 },
        "image_height": { "type": "integer", "minimum": 1 },
        "frames_min": { "type": "integer", "minimum": 1 },
        "frames_target": { "type": "integer", "minimum": 0 },
        "color_mode": { "type": "string", "enum": ["OSC", "MONO", "RGB"] },
        "bayer_pattern": { "type": "string" },
        "linear_required": { "type": "boolean" }
      }
    },
    "normalization": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "mode": { "type": "string", "enum": ["background", "median"] },
        "per_channel": { "type": "boolean" }
      }
    },
    "registration": {
      "type": "object",
      "properties": {
        "engine": { "type": "string", "enum": ["star_similarity", "opencv_cfa", "opencv_logpolar", "opencv_feature"] },
        "allow_rotation": { "type": "boolean" },
        "max_rotation_deg": { "type": "number", "minimum": 0, "maximum": 180 },
        "star_topk": { "type": "integer", "minimum": 3 },
        "star_min_inliers": { "type": "integer", "minimum": 2 },
        "star_inlier_tol_px": { "type": "number", "minimum": 0 },
        "star_dist_bin_px": { "type": "number", "minimum": 0 }
      }
    },
    "synthetic": {
      "type": "object",
      "properties": {
        "weighting": { "type": "string" },
        "frames_min": { "type": "integer", "minimum": 1 },
        "frames_max": { "type": "integer", "minimum": 1 },
        "clustering": {
          "type": "object",
          "properties": {
            "mode": { "type": "string" },
            "cluster_count_range": {
              "type": "array",
              "items": { "type": "integer", "minimum": 1 },
              "minItems": 2,
              "maxItems": 2
            }
          }
        }
      }
    }
  }
}
